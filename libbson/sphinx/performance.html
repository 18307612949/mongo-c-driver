<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Performance Notes &#8212; libbson 1.5.0-dev</title>
    
    <link rel="stylesheet" href="_static/mongoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.5.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Endianness" href="endianness.html" />
    <link rel="prev" title="JSON" href="json.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
    <div class="documentwrapper">
      <div class="bodywrapper">
        <div class="body" role="main">
          
            
          
          
  <div class="section" id="performance-notes">
<h1>Performance Notes<a class="headerlink" href="#performance-notes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="array-element-key-building">
<span id="performance-array-element-key-building"></span><h2>Array Element Key Building<a class="headerlink" href="#array-element-key-building" title="Permalink to this headline">¶</a></h2>
<p>When writing marshaling layers between higher level languages and Libbson, you will eventually need to build keys for array elements. Each element in a BSON array has a monotonic string key like <code class="docutils literal"><span class="pre">&quot;0&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;1&quot;</span></code>, etc. Using <code class="docutils literal"><span class="pre">snprintf()</span></code> and others tend to be rather slow on most <code class="docutils literal"><span class="pre">libc</span></code> implementations. Therefore, Libbson provides <a class="symbol reference internal" href="bson_uint32_to_string.html"><span class="doc">bson_uint32_to_string()</span></a> to improve this. Using this function allows an internal fast path to be used for numbers less than 1000 which is the vast majority of arrays. If the key is larger than that, a fallback of <code class="docutils literal"><span class="pre">snprintf()</span></code> will be used.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">;</span>
<span class="kt">uint32_t</span> <span class="n">i</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">bson_uint32_to_string</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">str</span><span class="p">);</span>
   <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Key: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information, see <a class="symbol reference internal" href="bson_uint32_to_string.html"><span class="doc">bson_uint32_to_string()</span></a>.</p>
</div>
</div>


        </div>
        <div class="footer">
          <div class="footer-nav">
            <a class="footer-nav-button footer-nav-button-prev" title="JSON" href="json.html">&laquo; Previous: JSON</a>
            <a class="footer-nav-button footer-nav-button-next" title="Endianness" href="endianness.html">Next: Endianness &raquo;</a>
          </div>
          <div class="colophon">
            Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1, based on <a href="https://sphinx-readable-theme.readthedocs.io/en/latest/">Sphinx Readable Theme</a>.
          </div>
        </div>
      </div>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3><a href="index.html">libbson 1.5.0-dev</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing Libbson</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="creating.html">Creating a BSON Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Handling Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="oid.html">ObjectIDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="parsing.html">Parsing and Iterating BSON Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="utf8.html">UTF-8</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="streaming-bson.html">Streaming BSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="json.html">JSON</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Performance Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Cross Platform Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="endianness.html">Endianness</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading.html">Threading</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bson_t.html">bson_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_context_t.html">bson_context_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_decimal128_t.html">bson_decimal128_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_error_t.html">bson_error_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_iter_t.html">bson_iter_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_json_reader_t.html">bson_json_reader_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_md5_t.html">bson_md5_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_oid_t.html">bson_oid_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_reader_t.html">bson_reader_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_string_t.html">bson_string_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_subtype_t.html">bson_subtype_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_type_t.html">bson_type_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_uint32_to_string.html">bson_uint32_to_string()</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_unichar_t.html">bson_unichar_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_value_t.html">bson_value_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_visitor_t.html">bson_visitor_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_writer_t.html">bson_writer_t</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_get_monotonic_time.html">System Clock</a></li>
<li class="toctree-l1"><a class="reference internal" href="bson_memory.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="version.html">Libbson Versioning</a></li>
</ul>

<a class="fullindex" href="full_index.html">Index</a>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, MongoDB, Inc.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>