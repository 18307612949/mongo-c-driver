<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>BCON - BSON C Object Notation &mdash; MongoDB C Driver 0.8.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="MongoDB C Driver 0.8.1 documentation" href="index.html" />
    <link rel="next" title="Connections" href="connections.html" />
    <link rel="prev" title="BSON" href="bson.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="connections.html" title="Connections"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="bson.html" title="BSON"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">MongoDB C Driver 0.8.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="bcon-bson-c-object-notation">
<h1>BCON - BSON C Object Notation<a class="headerlink" href="#bcon-bson-c-object-notation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>BCON provides for JSON-like (or BSON-like) initializers in C.
Without this, BSON must be constructed by procedural coding via explicit function calls.
With this, you now have concise, readable, and maintainable data-driven definition of BSON documents.
Here are a couple of introductory examples.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">bcon</span> <span class="n">hello</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;world&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">};</span>
<span class="n">bcon</span> <span class="n">pi</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;pi&quot;</span><span class="p">,</span> <span class="n">BF</span><span class="p">(</span><span class="mf">3.14159</span><span class="p">),</span> <span class="n">BEND</span> <span class="p">};</span>
</pre></div>
</div>
<p>BCON is an array of bcon union elements with the default type of char* cstring.
A BCON document must be terminated with a char* cstring containing a single dot, i.e., &#8221;.&#8221;, or the macro equivalent BEND.</p>
<p>Cstring literals in double quotes are used for keys as well as for string values.
There is no explicit colon (&#8216;:&#8217;) separator between key and value, just a comma,
however it must be explicit or C will quietly concatenate the key and value strings for you.
Readability may be improved by using multiple lines with a key-value pair per line.</p>
<p>Macros are used to enclose specific types, and an internal type-specifier string prefixes a typed value.
Macros are also used to specify interpolation of values from references (or pointers to references) of specified types.</p>
<p>Sub-documents are framed by &#8220;{&#8221; &#8220;}&#8221; string literals, and sub-arrays are framed by &#8220;[&#8221; &#8220;]&#8221; literals.</p>
<p>All of this is needed because C arrays and initializers are mono-typed unlike dict/array types in modern languages.
BCON attempts to be readable and JSON-like within the context and restrictions of the C language.</p>
</div>
<div class="section" id="important-note">
<h2>Important Note<a class="headerlink" href="#important-note" title="Permalink to this headline">¶</a></h2>
<p>BCON depends on C99 designated initializers.  The Microsoft Visual Studio (2012) C compiler does not yet support C99
designated initializers, so if you want BCON on Windows, you will have to install and use a compiler that supports C99
like gcc.</p>
</div>
<div class="section" id="specification">
<h2>Specification<a class="headerlink" href="#specification" title="Permalink to this headline">¶</a></h2>
<p>This specification parallels the BSON specification ( <a class="reference external" href="http://bsonspec.org/#/specification">http://bsonspec.org/#/specification</a> ).
The specific types and their corresponding macros are documented in the bcon (union bcon) structure.
The base values use two-character macros starting with &#8220;B&#8221; for the simple initialization using static values.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c"><div class="highlight"><pre><span class="n">bcon</span> <span class="n">goodbye</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;world&quot;</span><span class="p">,</span> <span class="s">&quot;goodbye&quot;</span><span class="p">,</span> <span class="s">&quot;world&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">};</span>
<span class="n">bcon</span> <span class="n">awesome</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;BSON&quot;</span><span class="p">,</span> <span class="s">&quot;[&quot;</span><span class="p">,</span> <span class="s">&quot;awesome&quot;</span><span class="p">,</span> <span class="n">BF</span><span class="p">(</span><span class="mf">5.05</span><span class="p">),</span> <span class="n">BI</span><span class="p">(</span><span class="mi">1986</span><span class="p">),</span> <span class="s">&quot;]&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">};</span>
<span class="n">bcon</span> <span class="n">contact_info</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;firstName&quot;</span><span class="p">,</span> <span class="s">&quot;John&quot;</span><span class="p">,</span>
    <span class="s">&quot;lastName&quot;</span> <span class="p">,</span> <span class="s">&quot;Smith&quot;</span><span class="p">,</span>
    <span class="s">&quot;age&quot;</span>      <span class="p">,</span> <span class="n">BI</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
    <span class="s">&quot;address&quot;</span>  <span class="p">,</span>
    <span class="s">&quot;{&quot;</span><span class="p">,</span>
        <span class="s">&quot;streetAddress&quot;</span><span class="p">,</span> <span class="s">&quot;21 2nd Street&quot;</span><span class="p">,</span>
        <span class="s">&quot;city&quot;</span>         <span class="p">,</span> <span class="s">&quot;New York&quot;</span><span class="p">,</span>
        <span class="s">&quot;state&quot;</span>        <span class="p">,</span> <span class="s">&quot;NY&quot;</span><span class="p">,</span>
        <span class="s">&quot;postalCode&quot;</span>   <span class="p">,</span> <span class="s">&quot;10021&quot;</span><span class="p">,</span>
    <span class="s">&quot;}&quot;</span><span class="p">,</span>
    <span class="s">&quot;phoneNumber&quot;</span><span class="p">,</span>
    <span class="s">&quot;[&quot;</span><span class="p">,</span>
        <span class="s">&quot;{&quot;</span><span class="p">,</span>
            <span class="s">&quot;type&quot;</span>  <span class="p">,</span> <span class="s">&quot;home&quot;</span><span class="p">,</span>
            <span class="s">&quot;number&quot;</span><span class="p">,</span> <span class="s">&quot;212 555-1234&quot;</span><span class="p">,</span>
        <span class="s">&quot;}&quot;</span><span class="p">,</span>
        <span class="s">&quot;{&quot;</span><span class="p">,</span>
            <span class="s">&quot;type&quot;</span>  <span class="p">,</span> <span class="s">&quot;fax&quot;</span><span class="p">,</span>
            <span class="s">&quot;number&quot;</span><span class="p">,</span> <span class="s">&quot;646 555-4567&quot;</span><span class="p">,</span>
        <span class="s">&quot;}&quot;</span><span class="p">,</span>
    <span class="s">&quot;]&quot;</span><span class="p">,</span>
    <span class="n">BEND</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="comparison">
<h2>Comparison<a class="headerlink" href="#comparison" title="Permalink to this headline">¶</a></h2>
<p>JSON:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;BSON&quot;</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;awesome&quot;</span><span class="p">,</span> <span class="mf">5.05</span><span class="p">,</span> <span class="mi">1986</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>BCON:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">bcon</span> <span class="n">awesome</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;BSON&quot;</span><span class="p">,</span> <span class="s">&quot;[&quot;</span><span class="p">,</span> <span class="s">&quot;awesome&quot;</span><span class="p">,</span> <span class="n">BF</span><span class="p">(</span><span class="mf">5.05</span><span class="p">),</span> <span class="n">BI</span><span class="p">(</span><span class="mi">1986</span><span class="p">),</span> <span class="s">&quot;]&quot;</span><span class="p">,</span> <span class="n">BEND</span> <span class="p">};</span>
</pre></div>
</div>
<p>C driver calls:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">bson_init</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
<span class="n">bson_append_start_array</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="s">&quot;BSON&quot;</span> <span class="p">);</span>
<span class="n">bson_append_string</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="s">&quot;awesome&quot;</span> <span class="p">);</span>
<span class="n">bson_append_double</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="mf">5.05</span> <span class="p">);</span>
<span class="n">bson_append_int</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="mi">1986</span> <span class="p">);</span>
<span class="n">bson_append_finish_array</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">bson_finish</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
<span class="n">bson_print</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
<span class="n">bson_destroy</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="performance">
<h2>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h2>
<p>With compiler optimization -O3, BCON costs about 1.1 to 1.2 times as much
as the equivalent bson function calls required to explicitly construct the document.
This is significantly less than the cost of parsing JSON and constructing BSON,
and BCON allows value interpolation via pointers.</p>
</div>
<div class="section" id="reference-interpolation">
<h2>Reference Interpolation<a class="headerlink" href="#reference-interpolation" title="Permalink to this headline">¶</a></h2>
<p>Reference interpolation uses three-character macros starting with &#8220;BR&#8221; for simple dynamic values.
You can change the referenced content and the new values will be interpolated when you generate BSON from BCON.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">bson</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;pi&quot;</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">value</span> <span class="o">=</span> <span class="mf">3.14159</span><span class="p">;</span>
<span class="n">bcon</span> <span class="n">bc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">BRS</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="n">BRF</span><span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">),</span> <span class="n">BEND</span> <span class="p">};</span>
<span class="n">bson_from_bcon</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="n">bc</span> <span class="p">);</span> <span class="c1">// generates { name: &quot;pi&quot;, &quot;value&quot;, 3.14159 }</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;e&quot;</span><span class="p">);</span>
<span class="n">value</span> <span class="o">=</span> <span class="mf">2.71828</span><span class="p">;</span>
<span class="n">bson_from_bcon</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="n">bc</span> <span class="p">);</span> <span class="c1">// generates { name: &quot;pi&quot;, &quot;value&quot;, 3.14159 }</span>
</pre></div>
</div>
<p>Please remember that in C, the array type is anomalous in that an identifier is (already) a reference,
therefore there is no ampersand &#8216;&amp;&#8217; preceding the identifier for reference interpolation.
This applies to BRS(cstring), BRD(doc), BRA(array), BRO(oid), and BRX(symbol).
An ampersand &#8216;&amp;&#8217; is needed for value types BRF(&amp;double), BRB(&amp;boolean), BRT(&amp;time), BRI(&amp;int), and BRL(&amp;long).
For completeness, BRS, BRD, BRA, BRO, and BRX are defined even though BS, BD, BA, BO, and BX are equivalent.</p>
</div>
<div class="section" id="pointer-interpolation">
<h2>Pointer Interpolation<a class="headerlink" href="#pointer-interpolation" title="Permalink to this headline">¶</a></h2>
<p>Pointer(-to-reference) interpolation uses three-character macros starting with &#8220;BP&#8221; for <strong>conditional</strong> dynamic values.
You can change the pointer content and the new values will be interpolated when you generate BSON from BCON.
If you set the pointer to null, the element will skipped and not inserted into the generated BSON document.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">bson</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;pi&quot;</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">new_name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;log(0)&quot;</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">**</span><span class="n">pname</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">name</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">value</span> <span class="o">=</span> <span class="mf">3.14159</span><span class="p">;</span>
<span class="kt">double</span> <span class="o">*</span><span class="n">pvalue</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">;</span>
<span class="n">bcon</span> <span class="n">bc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">BPS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pname</span><span class="p">),</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="n">BPF</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pvalue</span><span class="p">),</span> <span class="n">BEND</span> <span class="p">};</span>
<span class="n">bson_from_bcon</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="n">bc</span> <span class="p">);</span> <span class="c1">// generates { name: &quot;pi&quot;, &quot;value&quot;, 3.14159 }</span>
<span class="n">pname</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">new_name</span><span class="p">;</span>
<span class="n">pvalue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">bson_from_bcon</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="n">bc</span> <span class="p">);</span> <span class="c1">// generates { name: &quot;log(0)&quot; }</span>
</pre></div>
</div>
<p>Pointer interpolation necessarily adds an extra level of indirection and complexity.
All macro pointer arguments are preceded by &#8216;&amp;&#8217;.
Underlying pointer types are double-indirect (**) for array types and single-indirect (*) for value types.
Char name[] is used above to highlight that the array reference is not assignable (in contrast to char* array).
Please note the (char**)&amp; cast-address sequence required to silence the &#8220;incompatible-pointer-types&#8221; warning.</p>
</div>
<div class="section" id="additional-notes">
<h2>Additional Notes<a class="headerlink" href="#additional-notes" title="Permalink to this headline">¶</a></h2>
<p>Use the BS macro or the &#8221;:_s:&#8221; type specifier for string to allow string values that collide with type specifiers, braces, or square brackets.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">bson</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">bcon</span> <span class="n">bc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;spec&quot;</span><span class="p">,</span> <span class="n">BS</span><span class="p">(</span><span class="s">&quot;:_s:&quot;</span><span class="p">),</span> <span class="n">BEND</span> <span class="p">};</span>
<span class="n">bson_from_bcon</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="n">bc</span> <span class="p">);</span> <span class="c1">// generates { spec: &quot;:_s:&quot; }</span>
</pre></div>
</div>
<p>BCON does not yet support the following BSON types.</p>
<table border="1" class="docutils">
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">element</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>05  e_name  binary</td>
<td>Binary data</td>
</tr>
<tr class="row-odd"><td>06  e_name</td>
<td>undefined - deprecated</td>
</tr>
<tr class="row-even"><td>0B  e_name  cstring cstring</td>
<td>Regular expression</td>
</tr>
<tr class="row-odd"><td>0C  e_name  string (byte*12)</td>
<td>DBPointer - Deprecated</td>
</tr>
<tr class="row-even"><td>0D  e_name  string</td>
<td>JavaScript code</td>
</tr>
<tr class="row-odd"><td>0F  e_name  code_w_s</td>
<td>JavaScript code w/ scope</td>
</tr>
<tr class="row-even"><td>11  e_name  int64</td>
<td>Timestamp</td>
</tr>
<tr class="row-odd"><td>FF  e_name</td>
<td>Min key</td>
</tr>
<tr class="row-even"><td>7F  e_name</td>
<td>Max key</td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">BCON - BSON C Object Notation</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#important-note">Important Note</a></li>
<li><a class="reference internal" href="#specification">Specification</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#comparison">Comparison</a></li>
<li><a class="reference internal" href="#performance">Performance</a></li>
<li><a class="reference internal" href="#reference-interpolation">Reference Interpolation</a></li>
<li><a class="reference internal" href="#pointer-interpolation">Pointer Interpolation</a></li>
<li><a class="reference internal" href="#additional-notes">Additional Notes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="bson.html"
                        title="previous chapter">BSON</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="connections.html"
                        title="next chapter">Connections</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/bcon.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="connections.html" title="Connections"
             >next</a> |</li>
        <li class="right" >
          <a href="bson.html" title="BSON"
             >previous</a> |</li>
        <li><a href="index.html">MongoDB C Driver 0.8.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, 10gen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1-xgen1-.
    </div>
  </body>
</html>